self.dash=function(y){var z=y.document?y.document.getElementsByTagName("script"):[],z=z[z.length-1]||null,E=y.dashPath||null!==z&&null!==z.src.match(/dash/)?z.src:null,r={},L,M={},N={},D=y.indexedDB||indexedDB,w=y.IDBKeyRange||IDBKeyRange,ga=y.DOMStringList||(self?Array:DOMStringList),O=null!==y.constructor.toString().match(/WorkerGlobalScope/)?!0:!1,X=!!D.webkitGetDatabaseNames,ha=self.Worker&&null!==E&&E.match(/dash/)?!0:!1,C=function(a){var b={},c;if(q(a)){b=function(){return a.apply(this,arguments)};
for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}if(P(a))return parseInt(a,10);if(A(a))return a=a.slice(0),k(a,function(c,b){a[b]=C(c)}),a;if(!F(a))return a;u(a,function(a,c){!F(c)||q(c)||A(c)?b[a]=c:b[a]=C(c)});return b},p=function(a){if(F(a)){var b=0;u(a,function(){b+=1});if(0===b)return!0}return void 0!==a&&null!==a&&""!==a&&(!A(a)||0<a.length)?!1:!0},g=function(a,b,c,d){if(q(a))return a.apply(c||{},b||[]);if(q(d))return g(d,[])},e=function(a){return p(a)?!1:!0},Y=function(a,b){return b===
a},Z=function(a){var b={};k(t,function(c){e(a[c])&&(b[c]=a[c])});return b},A=function(a){var b=!1;if(a instanceof Array||a instanceof ga)b=!0;return b},B=function(a){return"boolean"===typeof a||"true"===a||"false"===a?!0:!1},q=function(a){return"function"===typeof a},F=function(a){return null!==a&&void 0!==a&&"object"===typeof a&&"[object Object]"===a.toString()},P=function(a){var b;(b="number"===typeof a)||(b=void 0===isNaN(parseInt(a,10),!1));return b?!0:!1},aa=function(a){return"string"===typeof a},
ca=function(a,b){for(var c=b||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=a||16,f=0,e=c.length,l=[],f=0;f<d;f+=1)l.push(c[Math.floor(100*Math.random())%e]);return l.join("")},k=function(a,b,c){var d,f=a?a.length:0;c=c||1;for(d=0;d<f;d+=c)g(b,[a[d],d])},u=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])},G=function(){var a=!1,b=null,c=[],d=[],f=[],e=[],l=[],h=function(x,h,ia){var ja=G();d.push(G);!0===a&&g(b?x:h,c);k([[e,x],[l,h],[f,ia]],function(a){var c=a[1];q(c)&&
a[0].push(c)});return ja.promise};h.then=h;h.error=function(a){h(null,a)};h.notify=function(a){h(null,null,a)};return{promise:h,resolve:function(){var f=arguments;a=b=!0;c=f;k(e,function(a){g(a,f)});k(d,function(a){g(a.resolve,f)})},notify:function(){var a=arguments;k(f,function(c){g(c,a)});k(d,function(c){g(c.notify,a)})},reject:function(){var f=arguments;b=!1;a=!0;c=f;k(l,function(a){g(a,f)})}}},v=function(a,b,c){var d=!1;e(a)&&(F(a)?u(a,function(a,e){if(!0===c&&b===a||b===e)d=!0}):A(a)&&k(a,function(a,
e){if(!0===c&&b===e||b===a)d=!0}));return d},Q="on_success on_error on_abort on_blocked on_upgrade_needed on_close on_complete".split(" "),da="amount db entry entries databases idx indexes key last_entry last_key total last_primary_key new_version objectstore old_version stores value".split(" "),t="auto_increment callback data database databases direction duplicates index index_key_path index_multi_entry index_unique key_path limit multi_entry primary_key skip store store_key_path unique version".split(" "),
R="auto_increment database store version store_key_path unique multi_entry data index index_left_open index_right_open index_left_bound index_right_bound index_key_path index_multi_entry index_unique key_path limit multi_entry primary_key skip store store_key_path unique duplicates on_complete on_error on_success on_abort key direction index index_key_path index_multi_entry index_unique limit skip version".split(" "),H=function(a){var b={};k(R,function(c){e(a[c])&&(b[c]=a[c])});return b},ea=function(a){var b=
function(a){!1===v(t,a)&&t.push(a);!1===v(R,a)&&R.push(a)};A(a)?k(a,function(a){b(a)}):b(a)},I=function(a,b){var c={},d=function(a){var c=[];k(a,function(a){c.push(a)});return c};k(t,function(b){e(a[b])&&(c[b]="db"===b?S({name:a[b].name,version:a[b].version,objectStoreNames:d(a[b].objectStoreNames)},"database",a):"objectstore"===b?S({name:a[b].name,indexNames:d(a[b].indexNames),autoIncrement:a[b].autoIncrement,keyPath:a[b].keyPath},"store",a):"idx"===b?S({name:a[b].name,multiEntry:a[b].multiEntry,
unique:a[b].unique,keyPath:a[b].keyPath},"index",a):"indexes"===b||"stores"===b||"databases"===b?d(a[b]):a[b])});Y(fa(b),"versionchange")&&ka(a);return c},fa=function(a){return v(["add.index","remove.index","add.store","remove.store"],a)?"versionchange":v(["get.entry","get.entries"],a)?"readonly":"readwrite"},T=function(a,b){var c=function(c){a.event=c;return a},d,f=0,ba=a.limit,l=a.skip;e(a.direction)||(a.direction=e(a)&&!1===a.duplicates?"nextunique":"next");a.range=a.range||M.get(a);e(a.data)&&
(a.data=q(a.data)?a.data():C(a.data));p(a.transaction)&&(a.db=a.event.target.result,a.transaction=a.db.transaction([a.store],a.type));p(a.objectstore)&&(a.objectstore=a.transaction.objectStore(a.store));p(a.idx)&&!p(a.index)&&(a.idx=a.objectstore.index(a.index));d=p(a.index)?a.objectstore.openCursor(a.range,a.direction):a.idx.openCursor(a.range,a.direction);a.amount=a.amount||0;d.transaction.addEventListener("complete",function(b){a.cursor=d.result;a=c(b);a.last_key=a.key;delete a.key;a.last_primary_key=
a.primary_key;delete a.primary_key;a.last_entry=a.entry;delete a.entry;delete a.direction;a.last_entry instanceof IDBOpenDBRequest&&delete a.last_entry;complete(a)});d.transaction.addEventListener("error",function(b){a.error=b;a=c(b);error(a)});d.addEventListener("success",function(h){a.cursor=d.result;e(a.cursor)&&(a.primary_key=a.cursor.primaryKey,a.key=a.cursor.key,a.direction=a.cursor.direction);a=c(h);p(l)?(p(ba)||f++<ba)&&g(b,[a]):(e(a.cursor.advance)&&a.cursor.advance(l),l=null)})},K={},la=
function(a,b,c,d,f,e){var l=ca(),h=function(c){var b=c.data;if(void 0!==K[b.uid])switch(c.data.type){case "success":delete K[b.uid];a.removeEventListener("message",h);g(d,[b.context]);break;case "error":delete K[b.uid];a.removeEventListener("message",h);g(f,[b.context]);break;case "notify":g(e,[b.context])}},x=function(a){if(!q(a))return F(a)?u(a,function(c,b){a[c]=x(b)}):A(a)&&k(a,function(c,b){a[b]=x(c)}),a};K[l]={success:d,error:f,notify:e};a.addEventListener("message",h);a.postMessage({dash:b,
context:x(c),uid:l});return l},ma=function(a,b){var c=G(),d={on_success:b.on_success,on_error:b.on_error,on_abort:b.on_abort,on_complete:b.on_complete,on_upgrade_needed:b.on_upgrade_needed,on_blocked:b.on_blocked,on_close:b.on_close},f=new Worker(E),e=function(a){u(d,function(c,b){a[c]=b});return a};u(d,function(a,c){delete b[a]});la(f,a,b,function(a){c.resolve(e(a))},function(a){c.reject(e(a))},function(a){c.notify(e(a))});return c.promise},m={},na=function(a){var b={database:!1,store:!1,index:!1};
e(m[a.database])&&e(m[a.database].data)&&(b.database=!0,e(m[a.database].stores[a.store])&&e(m[a.database].stores[a.store].data)&&(b.store=!0,e(m[a.database].stores[a.store].indexes[a.index])&&e(m[a.database].stores[a.store].indexes[a.index].data)&&(b.index=!0)));return b},S=function(a,b,c){if(e(c)&&e(c.database)){m[c.database]=m[c.database]||{stores:{},data:null};if("database"===b)return m[c.database].data=a;if(e(c.store)){m[c.database].stores[c.store]=m[c.database].stores[c.store]||{indexes:{},data:null};
if("store"===b)return m[c.database].stores[c.store].data=a;e(c.index)&&(m[c.database].stores[c.store].indexes[c.index]=m[c.database].stores[c.store].indexes[c.index]||{data:null},"index"===b&&(m[c.database].stores[c.store].indexes[c.index].data=a))}}return a},ka=function(a){delete m[a.database];return a},oa=function(a,b,c){var d=fa(c),f=function(a,c){var b=H(a);if(p(a.database))return g(c,[a]);b.on_success=function(a){a.on_success=null;a.version=a.db.version;g(c,[a])};b.on_upgrade_needed=function(a){a.upgraded=
!0;a.version=a.new_version;a.on_upgrade_needed=null;event.target.result.close();g(c,[a])};r.get(b)},k=function(a,b){var f=H(a);if(p(a.store)||v(["add.store"],c))return g(b,[a]);f.on_success=function(a){a.on_success=null;a.db.objectStoreNames.contains(a.store)?(null!==a.request.transaction&&(a.objectstore=a.request.transaction.objectStore([a.store],d)),g(b,[a])):(a.db.close(),a.version=a.db.version+1,a.on_upgrade_needed=function(c){c.on_upgrade_needed=null;c.objectstore=c.db.createObjectStore(c.store,
{keyPath:aa(c.store_key_path)?c.store_key_path:null,autoIncrement:B(c.auto_increment)?c.auto_increment:!1});a.request.addEventListener("success",function(a){g(b,[c]);c.db.close()})},r.get(a))};f.version=null;r.get(f)},l=function(a,b){var f=H(a);if(p(a.store)||p(a.index)||v("add.store get.store remove.store get.stores remove.stores remove.index add.index".split(" "),c))return g(b,[a]);f.on_success=function(c){c.on_success=null;c.transaction=c.db.transaction([c.store],"readonly");c.objectstore=c.transaction.objectStore(c.store);
c.objectstore.indexNames.contains(a.index)?g(b,[c]):(c.version=c.db.version+1,c.on_upgrade_needed=function(a){a.objectstore=a.request.transaction.objectStore(a.store);a.idx=a.objectstore.createIndex(a.index,a.index_key_path,{unique:a.index_unique||!1,multiEntry:a.index_multi_entry||!1});a.on_upgrade_needed=null;a.request.transaction.addEventListener("success",function(c){g(b,[a]);a.db.close()})},c.transaction.addEventListener("success",function(){c.db.close();r.get(c)}))};r.get(f)},h=function(b){var f=
b.on_success,h=b.on_complete,l=b.on_error,n=H(b),k=function(b){b.on_success=function(a){a=I(a,c);a.on_success=f;success(a)};b.on_complete=function(a){a=I(a,c);a.on_complete=h;g(a.on_complete,[a])};b.on_error=function(a){a=I(a,c);a.on_error=l;error(a)};b.db=b.request.result;b.transaction=b.request.transaction;null===b.transaction&&(b.transaction=b.db.transaction([b.store],d));e(b.store)&&"versionchange"!==d?b.objectstore=b.transaction.objectStore(b.store):e(b.store)&&!v(["add.store","remove.store"],
c)&&(b.objectstore=b.transaction.objectStore(b.store));g(a,[b])};n.version=b.version;if(v(["get.databases","remove.database","get.database"],c))return g(a,[I(b,c)]);"versionchange"!==d?(n.on_success=k,n.on_upgrade_needed=null):(n.version=b.db.version+1,n.on_upgrade_needed=k,n.on_success=null);n.on_complete=null;r.get(n)};b=Z(b);b.type=d;(function(a){if(e(a)){var b=a?a.on_upgrade_needed:void 0,d=a?a.on_success:void 0,g=na(a);if(!0===g.database&&!0===g.store&&!0===g.index||v(["remove.database"],c))return h(a);
a.on_success=null;a.on_upgrade_needed=null;!1===g.database?f(a,function(a){k(a,function(a){l(a,function(a){a.on_success=d;a.on_upgrade_needed=b;h(a)})})}):!1===g.store?k(a,function(a){l(a,function(a){a.on_success=d;a.on_upgrade_needed=b;h(a)})}):l(a,function(a){a.on_success=d;a.on_upgrade_needed=b;h(a)})}})(b)},U=[],V=[],W={clone:C,contains:v,deferred:G,exists:e,is:Y,isEmpty:p,isnt:function(a,b){return b!==a},isArray:A,isBoolan:B,isRegEx:function(a){return q(a.constructor)&&null!==a.constructor.toString().match(/RegExp/)},
isFunction:q,isObject:F,isNumber:P,isString:aa,apply:g,each:k,iterate:u,random:ca,api:J},pa=function(a,b){return function(c){c=c||{};var d={};k(Q,function(a){d[a.replace(/^on_/,"")]=c[a]});!0===O&&u(c,function(a){!0===v(da,a)?delete c[a]:ea(a)});return function(a,c,d,h){var x=G(),m=0,r=v(["get.entries","update.entries","remove.entries"],b),y={success:"s",error:"e",abort:"a",complete:"c",upgrade_needed:"u",blocked:"b",closed:"l"},n,z=x.promise;u(c,function(b){a["on_"+b]=function(a,b,c){return function(d){F(d)&&
u(b,function(a,b){var c="on_"+a;q(b)?d[c]=b:delete d[c]});d=Z(d);var e=null,f,h,l=0,m=G(),n=m.promise,e="s"===a&&!0===r?"notify":"e"===a||"a"===a||"b"===a?"reject":"resolve";f=I(d,c);k(V,function(a){h=g(a,[{type:e,method:c,context:f,priority:++l,promise:n}],C(W));f=h.context||f;n=h.promise||n;v(["reject","resolve"],e)&&(e=h.type||e)});n(function(a){"abort"==a.type&&(a.type="reject");if(!p(a.type)&&q(x[a.type]))x[a.type](a.context)},function(a){x.reject(a.context)},function(a){x.notify(a.context)});
m.resolve(C({method:c,type:e,context:f}))}}(y[b],c,h)});if(null!==h.match(/\.behavior/))g(d,[a]);else try{var A=G(),t=A.promise,w={},B=!1,D=null;W.api=J;k(U,function(b){B||(n=g(b,[{type:D,method:h,context:a,priority:++m,promise:t}],C(W)),a=n.context||a,u(a,function(a){ea(a)}),"resolve"===n.type?B=!0:h=n.method||h,D=n.type,t=n.promise)});t(function(b){!0!==r&&!0!==B||!0===O||!0!==X||!e(E)||!0!==ha?oa(d,a,b.method):(u({on_success:b.context.on_success,on_error:b.context.on_error,on_abort:b.context.on_abort,
on_complete:b.context.on_complete,on_upgrade_needed:b.context.on_upgrade_needed,on_blocked:b.context.on_blocked,on_close:b.context.on_close},function(b,c){w[b]=a[b];a[b]=c}),!1===B&&(t=ma(h,a)),t(function(a){a=a.context||a;g(w.on_complete,[a])},function(a){a=a.context||a;g(w.on_error,[a])},function(a){a=a.context||a;g(w.on_success,[a])}))},function(b){a.error=b.error;error(a)});A.resolve(C({method:h,type:D,context:a}))}catch(H){a.error=H,error(a)}return z}(c,d,a,b)}},qa=self,J;E&&null===E.match(/dash/)&&
(E=null);t.push.apply(t,Q);t.push.apply(t,da);k(Q,function(a){qa[a.replace(/^on_/g,"")]=function(b){g(b[a],[b]);return b}});r.close=function(a,b){a.db.close();!0!==b&&success(a)};r.remove=function(a,b){D.deleteDatabase(a.database);!0!==b&&success(a)};r.get=function(a,b){var c=a.on_upgrade_needed,d=a.on_success,f=a.on_error,k=!1,l=function(a,b){b.event=a;b.transaction=b.request?b.request.transaction:a.target.transaction;e(b.transaction)&&e(b.transaction.db)&&(b.db=b.transaction.db);e(a.newVersion)?
(b.new_version=a.newVersion,b.old_version=a.oldVersion,b.upgrade=b.new_version!==b.old_version?!0:!1):b.upgrade=!1;return b};a.request=P(a.version)?D.open(a.database,a.version):D.open(a.database);a.request.addEventListener("upgradeneeded",function(b){k=!0;a=l(b,a);a.upgrade=!0;a.opened=!0;a.db=b.target.result;a.on_upgrade_needed=c;upgrade_needed(a)});a.request.addEventListener("success",function(b){k||(a=l(b,a),a.upgrade=!1,a.opened=!0,a.on_success=d,a.db=b.target.result,success(a),b.target.result.close())});
a.request.addEventListener("blocked",function(a){});a.request.addEventListener("error",function(b){a=l(b,a);g(f,[a])})};z=function(a){success(a)};L=function(a){a.idx=a.objectstore.index(a.index);success(a)};M.get=function(a){var b=null,c=a.index_left_bound,d=a.index_right_bound,f=a.index_left_open,g=a.index_right_open;e(c)&&e(d)&&B(f)&&B(g)?b=w.bound(c,d,f,g):e(c)&&e(d)?b=w.bound(c,d,f||!1,g||!1):e(c)&&B(f)?b=w.lowerBound(c,!f):e(d)&&B(g)?b=w.upperBound(d,!g):e(a.value)?b=w.only(a.value):e(c)?b=w.lowerBound(c):
e(d)&&(b=w.upperBound(d));a.result=b;success(a);return b};N.add=function(a){A(a)?(q(a[0])&&U.push(a[0]),q(a[1])&&V.push(a[1])):q(a)&&(U.push(a),V.push(a))};J=function(a){var b={},c=[],d;u(a,function(a,e){c=a.split(".");d=c[0];b[d]=b[d]||{};b[d][c[1]]=pa(e,a)});return b}({"add.entry":function(a){var b;a.data=q(a.data)?a.data():C(a.data);b=a.objectstore.add(a.data);a.transaction.addEventListener("error",function(b){a.error=b.target.error.message;error(a)});b.addEventListener("success",function(){a.key=
b.result;a.entry=a.data;p(a.objectstore.keyPath)||(a.entry[a.objectstore.keyPath]=a.key);success(a)})},"add.behavior":N.add,"add.database":r.get,"add.store":z,"add.index":L,"clear.store":function(a){a.objectstore.clear();success(a)},"count.entries":function(a){var b;e(a.index)?(a.idx=a.objectstore.index(a.index),b=p(a.key)?a.idx.count():a.idx.count(a.key)):b=p(a.key)?a.objectstore.count():a.objectstore.count(a.key);a.transaction.addEventListener("error",function(b){a.error=b.target.error.message;
error(a)});b.addEventListener("success",function(){a.total=b.result;success(a)})},"get.behaviors":N.get,"get.database":r.get,"get.databases":function(a){var b=a.on_success;if(!1===X)return error(a);a.request=D.webkitGetDatabaseNames();a.request.addEventListener("success",function(c){a.databases=c.target.result;a.on_success=b;success(a)})},"get.store":z,"get.stores":function(a){a.stores=a.db.objectStoreNames;success(a)},"get.index":L,"get.indexes":function(a){a.indexes=a.objectstore.indexNames;success(a)},
"get.entries":function(a){a.type="readonly";var b=a.on_success;a.on_success=null;T(a,function(a){if(e(a.cursor)&&(a.on_success=b,a.entry=a.cursor.value,a.amount=a.amount||0,a.amount+=1,success(a),e(a.cursor["continue"])))a.cursor["continue"]()})},"get.entry":function(a){var b;e(a.index)?(a.idx=a.objectstore.index(a.index),b=!1===a.value?a.idx.getKey(a.key):a.idx.get(a.key)):b=a.objectstore.get(a.key);a.transaction.addEventListener("error",function(b){a.error=b.target.error.message;error(a)});b.addEventListener("success",
function(){a.entry=b.result;p(a.entry)?(a.error="no such entry",error(a)):success(a)})},"remove.database":r.remove,"remove.entries":function(a){a.type="readwrite";var b=a.on_success;T(a,function(a){a.entry=a.request;if(e(a.cursor)&&(a.on_success=b,a.entry=a.cursor.value,a.amount=a.amount||0,a.amount+=1,a.cursor["delete"](),success(a),e(a.cursor["continue"])))a.cursor["continue"]()})},"remove.index":function(a){a.objectstore.deleteIndex(a.index);success(a)},"remove.entry":function(a){var b,c=e(a.range)||
e(a.upper)||e(a.lower)||e(a.only);b=a.objectstore["delete"](c?a.range||M.get(a):a.key);a.transaction.addEventListener("complete",function(){a.entry=b.result;success(a)});a.transaction.addEventListener("error",function(b){a.error=b.target.error.message;error(a)})},"remove.store":function(a){a.db.deleteObjectStore(a.store);success(a)},"update.entries":function(a){a.type="readwrite";var b=a.on_success;T(a,function(a){if(e(a.cursor)&&(a.on_success=b,a.entry=a.cursor.value,a.amount=a.amount||0,a.amount+=
1,a.cursor.update(a.data),success(a),e(a.cursor["continue"])))a.cursor["continue"]()})},"update.entry":function(a){var b;a.data=q(a.data)?a.data():C(a.data);b=e(a.key)?a.objectstore.put(a.data,a.key):a.objectstore.put(a.data);b.addEventListener("success",function(){a.key=b.result;a.entry=a.data;success(a)});a.transaction.addEventListener("error",function(b){a.error=b.target.error.message;error(a)})}});!0===O&&y.addEventListener("message",function(a){var b=a.data,c=b.dash.split(".");a=c[0];var c=c[1],
d=function(a){b.context=a;y.postMessage(b)};void 0!==dash[a]&&void 0!==dash[a][c]?J[a][c](b.context)(function(a){b.type="success";d(a)},function(a){b.type="error";d(a)},function(a){b.type="notify";d(a)}):(b.type="error",d({error:"No such method"}))},!1);return J}(self||{});
