var dash=function(){var b={dbs:{},database:{},databases:{},store:{},stores:{},index:{},indexes:{},range:{},object:{},objects:{},transaction:{},kr:window.IDBKeyRange,clone:function(a){var c={};if(b.isNumber(a))return parseInt(a,10);if(b.isArray(a))return a.slice(0);b.safeIterate(a,function(a,d){!b.isObject(d)||b.isFunction(d)||b.isArray(d)?c[a]=d:c[a]=b.clone(d)});return c},isEmpty:function(a){return b.isnt(a,void 0)&&b.isnt(a,null)&&b.isnt(a,"")&&(!b.isArray(a)||0<a.length)?!1:!0},exists:function(a){return b.isEmpty(a)?
!1:!0},contains:function(a,c,e){var d=!1;b.exists(a)&&b.safeIterate(a,function(a,g){if(b.is(e,!0)&&b.is(a,c)||b.is(g,c))d=!0});return d},hasPath:function(a,c){var e=c.split("."),d=e.shift();if(b.isEmpty(a))return!1;for(;d;){if(b.isEmpty(a[d]))return!1;a=a[d];d=e.shift()}return!0},is:function(b,c){return c===b},isnt:function(b,c){return c!==b},isObject:function(a){return b.isnt(a,null)&&b.isType("object",a)&&b.is("[object Object]",a.toString())},isString:function(a){return b.isType("string",a)},isFunction:function(a){return b.isType("function",
a)},isTransaction:function(b){return b instanceof IDBTransaction?!0:!1},isDatabase:function(b){return b instanceof IDBDatabase?!0:!1},isCursorWithValue:function(b){return b instanceof IDBCursorWithValue?!0:!1},isOpenRequest:function(b){return b instanceof IDBOpenDBRequest?!0:!1},transactionIsAtLeast:function(a,c){return b.is(a,b.transaction.versionChange)?!0:b.is(a,b.transaction.readWrite)?b.is(c,b.transaction.versionChange)?!1:!0:b.is(c,b.transaction.read)?!0:!1},isArray:function(b){var c=!1;if(b instanceof
Array||b instanceof DOMStringList)c=!0;return c},isNumber:function(a){return b.isType("number",a)||b.is(isNaN(parseInt(a,10),!1))?!0:!1},isBoolean:function(a){return b.isType("boolean",a)||b.is(a,"true")||b.is(a,"false")?!0:!1},isType:function(a,c){return b.is(a,typeof c)},extend:function(a,c,e){a=a||{};b.safeIterate(b.clone(c),function(c,f){b.is(!0,e)&&b.isObject(f)?a[c]=b.extend({},f,e):a[c]=f});return a},safeIterate:function(b,c){for(var e in b)b.hasOwnProperty(e)&&c(e,b[e])},safeEach:function(a,
c,e){var d=a.length,f=1;!0===e&&(f=-f);for(e=0;e<d;e+=f)b.safeApply(c,[e,a[e]])},safeApply:function(a,c,e,d){if(b.isFunction(a))return a.apply(e||b,c||[]);if(b.isFunction(d))return b.safeApply(d,[])},standardCallbackNames:"on_success on_error on_abort on_blocked on_upgrade_needed on_close on_complete".split(" ")};b.safeEach(b.standardCallbackNames,function(a,c){b[c.replace(/^on_/g,"")]=function(a){b.safeApply(a[c],[a]);return a}});b.standardRequest=function(a){var c=a.request,e={};a=b.standardCallbacks(a);
b.exists(c)&&b.is(c.readyState,"done")&&(a.result=b.objectResult(a),b.success(a));b.safeEach(b.standardCallbackNames,function(b,c){e[c.replace(/_/g,"")]=a[c]});a.request=b.extend(c,e);return a};b.standardCursor=function(a,c){var e=0,d=function(b){a.event=b;return a},f=a.on_success,g=a.on_error,l=a.on_abort,h=a.on_complete,m;a.direction=a.direction||b.objects.next();a.range=a.range||b.range.get(a);a.type=b.transaction.readWrite;a.entries=[];a.transaction=b.transaction.create(a);a.objectstore=a.transaction.objectStore(a.store);
a.data=b.isFunction(a.data)?a.data():b.clone(a.data);try{b.isEmpty(a.index)?a.request=a.objectstore.openCursor(a.range,a.direction):(a.idx=a.objectstore.index(a.index),a.request=a.idx.openCursor(a.range,a.direction)),b.standardRequest(b.extend(a,{on_success:function(d){var k=function(){e+=1;if(b.isNumber(d.limit)&&e>=d.limit)b.complete(d);else if(b.exists(d.cursor))if(b.exists(d.skip_each))try{d.cursor.advance(a.skip_each)}catch(c){d.error=c,b.error(d)}else if(b.isFunction(d.cursor["continue"])){d.request.source.objectStore.transaction.oncomplete=
function(a){d.event=a;d.on_complete=h;b.complete(d)};try{d.cursor["continue"]()}catch(f){d.on_complete=h,b.complete(d)}}else d.on_complete=h,b.complete(d);else d.on_complete=h,b.complete(d)};d.flagged=!1;d.cursor=d.request.result;d.result=b.exists(d.cursor)?d.cursor.value:null;if(b.isCursorWithValue(d.cursor))a.entries.push(d.cursor.value);else return k(d);b.exists(d.expecting)&&b.safeIterate(d.expecting,function(a,e){var c=b.hasPath(d.result,a)?d.result[a]:null;b.isFunction(e)&&(e=e(c));b.exists(c)&&
b.exists(e)&&b.isnt(c,e)&&(d.flagged=!0)});if(b.is(d.flagged,!1)&&b.exists(d.cursor)&&b.exists(d.result)){d.data=b.is(d.replace,!0)?d.result:b.extend(d.result,d.data);try{m=c(d),b.exists(m)?(d.on_success=function(a){d.event=a;k(d);d.on_success=f;b.success(d)},d.on_error=function(a){d.event=a;k(d);d.on_error=g;b.error(d)},b.standardRequest(d)):k(d)}catch(q){d.error=q,d.on_error=g,b.error(a)}}else d.on_error=g,b.error(d)},on_error:function(e){a.on_error=g;b.error(d(e))},on_abort:function(e){a.on_error=
l;return b.abort(d(e))}}))}catch(k){a.error=k,b.error(a)}};b.objectResult=function(a){var c=a.event,e=null;if(b.isOpenRequest(a.request))return null;b.hasPath(c,"target.result.value")?e=c.target.result.value:b.hasPath(c,"target.result")?e=c.target.result:b.hasPath(c,"result")?e=c.result:b.hasPath(c,"request.result")&&(e=c.request.result);return e};b.standardCallbacks=function(a){var c={},e=function(e){a.event=e;a.transaction=a.request?a.request.transaction:e.target.transaction;a.result=b.objectResult(a);
b.exists(a.transaction)&&b.exists(a.transaction.db)&&(a.db=a.transaction.db);b.exists(e.newVersion)?(a.new_version=e.newVersion,a.old_version=e.oldVersion,b.isnt(a.old_version,a.new_version)?a.upgrade=!0:a.upgrade=!1):a.upgrade=!1;return a};b.safeEach(b.standardCallbackNames,function(d,f){c[f]=function(){return function(d){b.safeApply(a[f],[e(d)])}}()});return c};b.safeRequest=function(a,c,e){c=c||{};b.isEmpty(c.transaction)&&(c.transaction=b.transaction.create(c));b.exists(c.transaction)&&(c.objectstore=
b.maybeAttachStore(c));try{c=a(c),b.isnt(e,!1)&&b.standardRequest(c)}catch(d){c.error=d,b.error(c)}return c};b.maybeAttachStore=function(a){if(b.exists(a.objectstore)&&b.is(a.objectstore.transaction,a.transaction))return a.objectstore;if(b.exists(a.store)&&b.isTransaction(a.transaction))try{a.objectstore=b.safeApply(a.transaction.objectStore,[a.store],a.transaction)}catch(c){}return a.objectstore};b.transaction.read="readonly";b.transaction.readWrite="readwrite";b.transaction.versionChange="versionchange";
b.transaction.create=function(a){a.type=a.type||b.transaction.readWrite;if(b.exists(a.transaction)&&b.isTransaction(a.transaction)&&b.transactionIsAtLeast(a.transaction.mode,a.type)&&(!b.exists(a.request)||!b.exists(a.request.readyState)||b.isnt(a.request.readyState,"done")))return a.transaction;delete a.transaction;if(b.is(a.type,b.transaction.versionChange))b.error(a);else if(b.isDatabase(a.db))try{a.transaction=a.db.transaction([a.store],a.type)}catch(c){a.error=c,b.error(a)}finally{return a.transaction}};
b.database.close=function(a){return b.safeRequest(function(a){b.exists(a.db)&&(b.safeApply(a.db.close,[],a.db),b.success(a))},a,!1)};b.database["delete"]=function(a){a.type=b.transaction.readWrite;try{a.request=indexedDB.deleteDatabase(a.database),b.standardRequest(a)}catch(c){a.error=c,b.error(a)}};b.database.upgrade=function(a){var c=a.on_upgrade_needed,e=a.on_success;b.isEmpty(a.db)&&b.isEmpty(a.version)?b.error(a):b.isTransaction(a.transaction)&&b.is(a.transaction.mode,b.transaction.versionChange)?
b.success(a):(a.version=a.version||a.db.version+1,a.on_upgrade_needed=function(a){a.on_upgrade_needed=c;a.on_success=e;b.success(a)},b.database.open(a))};b.database.open=function(a){var c=a.on_upgrade_needed,e=a.on_success;if(b.isDatabase(a.db)&&b.is(a.db.version,a.version))return a.upgrade=!1,a.opened=!1,b.success(a);a.request=b.exists(a.version)?indexedDB.open(a.database,a.version):indexedDB.open(a.database);b.standardRequest(b.extend(a,{on_success:function(a){a.upgrade=!1;a.opened=!0;a.on_success=
e;b.exists(a.request)&&b.exists(a.request.transaction)?a.request.transaction.oncomplete=function(){a.db=a.request.result;a.transaction=a.request.transaction;b.success(a)}:(a.db=a.event.target.result||(b.exists(a.request)?a.request.result:null),b.success(a))},on_upgrade_needed:function(a){a.upgrade=!0;a.opened=!0;a.on_upgrade_needed=c;a.db=a.request.result;b.upgrade_needed(a)}}))};b.databases.get=function(a){var c=a.on_success;return b.safeRequest(function(a){if(!b.isFunction(indexedDB.webkitGetDatabaseNames))return b.error(a);
a.request=indexedDB.webkitGetDatabaseNames();a.on_success=function(a){a.databases=a.result;delete a.result;a.on_success=c;b.success(a)};b.standardRequest(a);return a},a,!1)};b.store.clear=function(a){a.type=b.transaction.readWrite;return b.safeRequest(function(a){a.request=b.safeApply(a.objectstore.clear,[],a.objectstore);return a},a)};b.store["delete"]=function(a){var c=a.on_success;a.type=b.transaction.versionChange;a.on_success=function(a){return b.safeRequest(function(d){d.db.deleteObjectStore(a.store);
d.on_success=c;b.success(d)},a,!1)};b.database.upgrade(a)};b.store.create=function(a){var c=a.on_success;a.type=b.transaction.versionChange;a.on_success=function(a){try{a.objectstore=a.db.createObjectStore(a.store,{keyPath:b.isString(a.store_key_path)?a.store_key_path:null,autoIncrement:b.isBoolean(a.auto_increment)?a.auto_increment:!1}),a.on_success=c,b.success(a)}catch(d){a.error=d,b.error(a)}};b.database.upgrade(a)};b.store.get=function(a){a.type=b.transaction.read;return b.safeRequest(function(a){b.success(a)},
a,!1)};b.stores.get=function(a){a.stores=a.db.objectStoreNames;b.success(a)};b.index.create=function(a){var c=a.on_success;a.type=b.transaction.versionChange;a.on_success=function(a){return b.safeRequest(function(a){a.idx=a.objectstore.createIndex(a.index,a.index_key_path,{unique:a.index_unique||!1,multiEntry:a.index_multi_entry||!1});a.on_success=c;b.success(a)},a,!1)};b.database.upgrade(a)};b.index.get=function(a){a.type=b.transaction.read;b.safeRequest(function(a){a.idx=a.objectstore.index(a.index);
b.success(a)},a,!1)};b.index["delete"]=function(a){var c=a.on_success,e=a.on_error;a.type=b.transaction.versionChange;a.on_success=function(a){a.on_error=e;b.safeRequest(function(a){a.objectstore.deleteIndex(a.index);a.on_success=c;b.success(a)},a,!1)};b.database.upgrade(a)};b.indexes.get=function(a){a.type=b.transaction.readWrite;return b.safeRequest(function(a){a.indexes=a.objectstore.indexNames;b.success(a)},a,!1)};b.object.add=function(a){var c=a.on_success;a.type=b.transaction.readWrite;return b.safeRequest(function(a){a.data=
b.isFunction(a.data)?a.data():b.clone(a.data);a.on_success=function(a){a.key=a.result;delete a.result;a.on_success=c;b.success(a)};a.request=a.objectstore.add(a.data);return a},a)};b.object["delete"]=function(a){var c=a.on_success;a.type=b.transaction.readWrite;return b.safeRequest(function(a){var d=b.exists(a.range)||b.exists(a.upper)||b.exists(a.lower)||b.exists(a.only);a.on_success=function(a){delete a.result;a.on_success=c;b.success(a)};a.key=d?a.range||b.range.get(a):a.key;a.request=a.objectstore["delete"](a.key);
return a},a)};b.object.get=function(a){var c=a.on_success;a.type=b.transaction.read;return b.safeRequest(function(a){var d=b.exists(a.range)||b.exists(a.upper)||b.exists(a.lower)||b.exists(a.only);a.key=d?a.range||b.range.get(a):a.key;b.exists(a.index)?(a.idx=a.objectstore.index(a.index),a.request=b.is(a.value,!1)?a.idx.getKey(a.key):a.idx.get(a.key)):a.request=a.objectstore.get(a.key);a.on_success=function(a){a.entry=a.result;delete a.result;a.on_success=c;b.success(a)};return a},a)};b.object.put=
function(a){var c=a.on_success;a.type=b.transaction.readWrite;return b.safeRequest(function(a){a.on_success=function(a){a.key=a.result;delete a.result;a.on_success=c;b.success(a)};a.data=b.isFunction(a.data)?a.data():a.data;a.request=b.exists(a.key)?a.objectstore.put(a.data,a.key):a.objectstore.put(a.data);return a},a)};b.objects["delete"]=function(a){var c=a.on_success;b.standardCursor(a,function(a){a.entry=a.cursor.value;a.on_success=c;b.success(a);return a.cursor["delete"]()})};b.objects.get=function(a){var c=
a.on_success;b.standardCursor(a,function(a){a.entry=a.cursor.value;a.on_success=c;b.success(a)})};b.objects.update=function(a){var c=a.on_success;b.standardCursor(a,function(a){a.entry=a.cursor.value;a.on_success=c;b.success(a);return a.cursor.update(a.data)})};b.range.get=function(a){var c=null,e=a.left_bound,d=a.right_bound,f=a.includes_left_bound,g=a.includes_right_bound;b.exists(e)&&b.exists(d)&&b.exists(f)&&b.exists(g)?c=b.kr.bound(e,d,f,g):b.exists(e)&&b.exists(f)?c=b.kr.lowerBound(e,f):b.exists(d)&&
b.exists(g)?c=b.kr.upperBound(d,g):b.exists(a.value)&&(c=b.kr.only(a.value));a.result=c;b.success(a);return c};b.objects.next=function(a){return b.exists(a)&&b.is(!1,a.duplicates)?"nextunique":"next"};b.objects.previous=function(a){return b.exists(a)&&b.is(!1,a.duplicates)?"prevunique":"prev"};b.deferred=function(){var a=!1,c=null,e=[],d=[],f=[],g=[],l=[];return{promise:{then:function(h,m,k){var n=b.deferred();d.push(n);b.is(a,!0)?b.safeApply(c?h:m,e):b.safeEach([[g,h],[l,m],[f,k]],function(a,c){var d=
c[1];b.isFunction(d)&&c[0].push(d)});return n.promise},commit:function(a,c,d){this.then(function(c){b.safeEach(["transaction","objectstore","idx","request","result"],function(a,b){delete c[b]});setTimeout(function(){b.safeApply(a,[c])},20)},c,d)}},resolve:function(){var f=arguments;b.is(a,!1)&&(a=c=!0,e=f,b.safeEach(g,function(a,c){b.safeApply(c,f)}),b.safeEach(d,function(a,c){b.safeApply(c.resolve,f)}))},notify:function(){var a=arguments;b.safeEach(f,function(c,d){b.safeApply(d,a)});b.safeEach(d,
function(c,d){b.safeApply(d.notify,a)})},reject:function(){var d=arguments;b.is(a,!1)&&(c=!1,a=!0,e=d,b.safeEach(l,function(a,c){b.safeApply(c,d)}))}}};b.wrap=function(a,c){return function(e){e=e||{};var d=b.deferred(),f=d.reject,g=d.resolve,l=d.notify,h=b.contains(["get.entries","update.entries","remove.entries"],c),m={success:e.on_success,error:e.on_error,abort:e.on_abort,complete:e.on_complete,upgrade_needed:e.on_upgrade_needed,blocked:e.on_blocked,close:e.on_close},k={success:"s",error:"e",abort:"a",
complete:"c",upgrade_needed:"u",blocked:"b",closed:"l"},n=function(a){var c=a[0];b.isObject(c)&&b.safeIterate(m,function(a,d){var e="on_"+a;b.isFunction(d)?c[e]=d:delete c[e]});a[0]=c;return a},p={};b.is(h,!1)&&b.is(c.split(".")[0],"record")&&(h=b.exists(e.index));b.safeIterate(m,function(a,c){p["on_"+a]=function(){b.safeApply(m[a],arguments);var c=arguments,d=k[a],e=null,e=b.is(d,"s")?h?l:g:b.is(d,"e")||b.is(d,"a")||b.is(d,"b")?f:g;b.safeApply(e,n(c))}});b.safeApply(a,[b.extend(e,p)]);return d.promise}};
return function(a){var c={},e=[],d,f=/^_/;b.safeIterate(a,function(a,l){e=a.split(".");b.isnt(e[0].match(f),null)?(d=e[0].replace(f,""),c[d]=c[d]||{},c[d][e[1]]=l):(d=e[0],c[d]=c[d]||{},c[d][e[1]]=b.wrap(l,a))});return c}({"close.database":b.database.close,"open.database":b.database.open,"remove.database":b.database["delete"],"upgrade.database":b.database.upgrade,"get.databases":b.databases.get,"add.store":b.store.create,"clear.store":b.store.clear,"get.store":b.store.get,"remove.store":b.store["delete"],
"get.stores":b.stores.get,"add.index":b.index.create,"get.index":b.index.get,"remove.index":b.index["delete"],"get.indexes":b.indexes.get,"add.entry":b.object.add,"remove.entry":b.object["delete"],"get.entry":b.object.get,"put.entry":b.object.put,"remove.entries":b.objects["delete"],"get.entries":b.objects.get,"update.entries":b.objects.update,"tools.extend":b.extend,"tools.defer":b.deferred})}();