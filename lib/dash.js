var dash=function(m){var b={dbs:{},database:{},databases:{},store:{},stores:{},index:{},indexes:{},range:{},entry:{},entries:{},transaction:{},db:m.indexedDB,kr:m.IDBKeyRange,sl:m.DOMStringList,clone:function(a){var c={};if(b.isNumber(a))return parseInt(a,10);if(b.isArray(a))return a.slice(0);b.safeIterate(a,function(a,e){!b.isObject(e)||b.isFunction(e)||b.isArray(e)?c[a]=e:c[a]=b.clone(e)});return c},isEmpty:function(a){return b.isnt(a,void 0)&&b.isnt(a,null)&&b.isnt(a,"")&&(!b.isArray(a)||0<a.length)?
!1:!0},exists:function(a){return b.isEmpty(a)?!1:!0},contains:function(a,c,d){var e=!1;b.exists(a)&&b.safeIterate(a,function(a,g){if(b.is(d,!0)&&b.is(a,c)||b.is(g,c))e=!0});return e},is:function(a,b){return b===a},isnt:function(a,b){return b!==a},isObject:function(a){return b.isnt(a,null)&&b.isType("object",a)&&b.is("[object Object]",a.toString())},isString:function(a){return b.isType("string",a)},isFunction:function(a){return b.isType("function",a)},standardCallbackNames:"on_success on_error on_abort on_blocked on_upgrade_needed on_close on_complete".split(" "),
attribs:"auto_increment callback data database databases db duplicates entries entry idx index index_key_path index_multi_entry index_unique indexes key multi_entry new_version objectstore old_version store store_key_path stores type unique version".split(" ")};b.attribs.push.apply(b.attribs,b.standardCallbackNames);b.results=function(a){var c={};b.safeEach(b.attribs,function(d){b.exists(a[d])&&(b.is(d,"db")?c[d]={name:a[d].name,version:a[d].version,objectStoreNames:a[d].objectStoreNames}:b.is(d,
"objectstore")?c[d]={name:a[d].name,indexNames:a[d].indexNames,autoIncrement:a[d].autoIncrement,keyPath:a[d].keyPath}:b.is(d,"idx")?c[d]={name:a[d].name,multiEntry:a[d].multiEntry,unique:a[d].unique,keyPath:a[d].keyPath}:c[d]=a[d])});return c};b.args=function(a){var c={};b.safeEach(b.attribs,function(d){b.exists(a[d])&&(c[d]=a[d])});return c};b.isArray=function(a){var c=!1;if(a instanceof Array||a instanceof b.sl)c=!0;return c};b.isNumber=function(a){return b.isType("number",a)||b.is(isNaN(parseInt(a,
10),!1))?!0:!1};b.isBoolean=function(a){return b.isType("boolean",a)||b.is(a,"true")||b.is(a,"false")?!0:!1};b.isType=function(a,c){return b.is(a,typeof c)};b.extend=function(a,c,d){a=a||{};b.safeIterate(b.clone(c),function(c,f){b.is(!0,d)&&b.isObject(f)?a[c]=b.extend({},f,d):a[c]=f});return a};b.safeIterate=function(a,b){for(var d in a)a.hasOwnProperty(d)&&b(d,a[d])};b.safeEach=function(a,c,d){var e,f=a.length;d=d||1;for(e=0;e<f;e+=d)b.safeApply(c,[a[e],e])};b.safeApply=function(a,c,d,e){if(b.isFunction(a))return a.apply(d||
b,c||[]);if(b.isFunction(e))return b.safeApply(e,[])};b.safeEach(b.standardCallbackNames,function(a){b[a.replace(/^on_/g,"")]=function(c){b.safeApply(c[a],[c]);return c}});b.standardCursor=function(a,c){var d=function(b){a.event=b;return a},e;a.direction=a.direction||b.entries.next();a.range=a.range||b.range.get(a);a.entries=[];b.isEmpty(a.transaction)&&(a.db=a.event.target.result,a.transaction=a.db.transaction([a.store],a.type));b.isEmpty(a.objectstore)&&(a.objectstore=a.transaction.objectStore(a.store));
b.isEmpty(a.idx)&&!b.isEmpty(a.index)&&(a.idx=a.objectstore.index(a.index));e=b.isEmpty(a.index)?a.objectstore.openCursor(a.range,a.direction):a.idx.openCursor(a.range,a.direction);e.transaction.addEventListener("complete",function(c){a.cursor=e.result;a=d(c);a.db.close();b.complete(a)});e.transaction.addEventListener("error",function(c){a.error=c;a=d(c);b.error(a)});e.addEventListener("success",function(f){a.cursor=e.result;a=d(f);b.safeApply(c,[a])})};b.transaction.read="readonly";b.transaction.readWrite=
"readwrite";b.transaction.versionChange="versionchange";b.database.close=function(a,c){a.db.close();b.isnt(c,!0)&&b.success(a)};b.database.remove=function(a,c){b.db.deleteDatabase(a.database);b.isnt(c,!0)&&b.success(a)};b.database.get=function(a){var c=a.on_upgrade_needed,d=a.on_success,e=a.on_blocked,f=!1,g=function(a,d){d.event=a;d.transaction=d.request?d.request.transaction:a.target.transaction;b.exists(d.transaction)&&b.exists(d.transaction.db)&&(d.db=d.transaction.db);d.upgrade=!1;b.exists(a.newVersion)&&
(d.new_version=a.newVersion,d.old_version=a.oldVersion,b.isnt(d.old_version,d.new_version)&&(d.upgrade=!0));return d};a.request=b.isNumber(a.version)?b.db.open(a.database,a.version):b.db.open(a.database);a.db&&a.db.close();a.request.addEventListener("success",function(c){f||(a=g(c,a),a.upgrade=!1,a.opened=!0,a.on_success=d,a.db=a.event.target.result,b.success(a))});a.request.addEventListener("upgradeneeded",function(d){f=!0;a=g(d,a);a.upgrade=!0;a.opened=!0;a.on_upgrade_needed=c;b.upgrade_needed(a)});
a.request.addEventListener("blocked",function(d){a=g(d,a);b.safeApply(e,[a])})};b.databases.get=function(a){var c=a.on_success;if(!b.isFunction(b.db.webkitGetDatabaseNames))return b.error(a);a.request=b.db.webkitGetDatabaseNames();a.request.addEventListener("success",function(d){a.databases=d.target.result||[];a.on_success=c;b.success(a)})};b.store.clear=function(a){a.objectstore.clear();b.success(a)};b.store.remove=function(a){a.db.deleteObjectStore(a.store);b.success(a)};b.store.get=function(a){b.success(a)};
b.stores.get=function(a){a.stores=a.db.objectStoreNames;b.success(a)};b.index.get=function(a){a.idx=a.objectstore.index(a.index);b.success(a)};b.index.remove=function(a){a.objectstore.deleteIndex(a.index);b.success(a)};b.indexes.get=function(a){a.indexes=a.objectstore.indexNames;b.success(a)};b.entry.add=function(a){var c;a.data=b.isFunction(a.data)?a.data():b.clone(a.data);c=a.objectstore.add(a.data);a.transaction.addEventListener("error",function(d){a.error=d.target.error.message;b.error(a)});c.addEventListener("success",
function(){a.key=c.result;b.success(a)})};b.entry.remove=function(a){var c,d=b.exists(a.range)||b.exists(a.upper)||b.exists(a.lower)||b.exists(a.only);a.data=b.isFunction(a.data)?a.data():b.clone(a.data);c=a.objectstore["delete"](d?a.range||b.range.get(a):a.key);a.transaction.addEventListener("complete",function(){a.entry=c.result;b.success(a)});a.transaction.addEventListener("error",function(d){a.error=d.target.error.message;b.error(a)})};b.entry.get=function(a){var c;a.data=b.isFunction(a.data)?
a.data():b.clone(a.data);b.exists(a.index)?(a.idx=a.objectstore.index(a.index),c=b.is(a.value,!1)?a.idx.getKey(a.key):a.idx.get(a.key)):c=a.objectstore.get(a.key);a.transaction.addEventListener("error",function(d){a.error=d.target.error.message;b.error(a)});c.addEventListener("success",function(){a.entry=c.result;b.success(a)})};b.entry.put=function(a){var c;a.data=b.isFunction(a.data)?a.data():b.clone(a.data);c=b.exists(a.key)?a.objectstore.put(a.data,a.key):a.objectstore.put(a.data);a.transaction.addEventListener("complete",
function(){a.key=c.result;b.success(a)});a.transaction.addEventListener("error",function(d){a.error=d.target.error.message;b.error(a)})};b.entries.remove=function(a){a.type=b.transaction.readWrite;var c=a.on_success;b.standardCursor(a,function(a){a.entry=a.request;if(b.exists(a.cursor)&&(a.on_success=c,a.entry=a.cursor.value,a.entries=a.entries||[],a.entries.push(a.entry),a.cursor["delete"](),b.success(a),b.exists(a.cursor["continue"])))a.cursor["continue"]()})};b.entries.get=function(a){a.type=b.transaction.read;
var c=a.on_success;a.on_success=null;b.standardCursor(a,function(a){if(b.exists(a.cursor)&&(a.on_success=c,a.entry=a.cursor.value,a.entries=a.entries||[],a.entries.push(a.entry),b.success(a),b.exists(a.cursor["continue"])))a.cursor["continue"]()})};b.entries.update=function(a){a.type=b.transaction.readWrite;var c=a.on_success;b.standardCursor(a,function(a){if(b.exists(a.cursor)&&(a.on_success=c,a.entry=a.cursor.value,a.data=b.isFunction(a.data)?a.data(a.entry):b.clone(a.data),a.entries=a.entries||
[],a.entries.push(a.entry),a.cursor.update(a.data),b.success(a),b.exists(a.cursor["continue"])))a.cursor["continue"]()})};b.range.get=function(a){var c=null,d=a.left_bound,e=a.right_bound,f=a.includes_left_bound,g=a.includes_right_bound;b.exists(d)&&b.exists(e)&&b.exists(f)&&b.exists(g)?c=b.kr.bound(d,e,f,g):b.exists(d)&&b.exists(f)?c=b.kr.lowerBound(d,f):b.exists(e)&&b.exists(g)?c=b.kr.upperBound(e,g):b.exists(a.value)&&(c=b.kr.only(a.value));a.result=c;b.success(a);return c};b.entries.next=function(a){return b.exists(a)&&
b.is(!1,a.duplicates)?"nextunique":"next"};b.entries.previous=function(a){return b.exists(a)&&b.is(!1,a.duplicates)?"prevunique":"prev"};b.deferred=function(){var a=!1,c=null,d=[],e=[],f=[],g=[],n=[];return{promise:function(l,h,r){var p=b.deferred();e.push(p);b.is(a,!0)?b.safeApply(c?l:h,d):b.safeEach([[g,l],[n,h],[f,r]],function(a){var d=a[1];b.isFunction(d)&&a[0].push(d)});return p.promise},resolve:function(){var f=arguments;b.is(a,!1)&&(a=c=!0,d=f,b.safeEach(g,function(a){b.safeApply(a,f)}),b.safeEach(e,
function(a){b.safeApply(a.resolve,f)}))},notify:function(){var a=arguments;b.safeEach(f,function(d){b.safeApply(d,a)});b.safeEach(e,function(d){b.safeApply(d.notify,a)})},reject:function(){var e=arguments;b.is(a,!1)&&(c=!1,a=!0,d=e,b.safeEach(n,function(a){b.safeApply(a,e)}))}}};b.transaction.queues=[];b.transaction.type=function(a){return b.contains(["add.index","remove.index","add.store","remove.store"],a)?b.transaction.versionChange:b.contains(["get.entry","get.entries"],a)?b.transaction.read:
b.transaction.readWrite};b.detachContext=function(a){return{database:a.database,store:a.store,version:null,store_key_path:a.store_key_path,unique:a.unique,multi_entry:a.multi_entry,data:a.data,auto_increment:a.auto_increment,on_complete:a.on_complete,key:a.key,index:a.index,index_key_path:a.index_key_path,index_multi_entry:a.index_multi_entry,index_unique:a.index_unique}};b.stage=function(a,c,d){var e=b.transaction.type(d),f=function(){var a=b.transaction.queues.shift(),c=a?a.on_upgrade_needed:void 0,
e=a?a.on_success:void 0;if(b.exists(a)){if(b.contains(["get.database","remove.database"],d))return h(a);a.on_success=null;a.on_upgrade_needed=null;g(a,function(a){n(a,function(a){l(a,function(a){a.on_success=e;a.on_upgrade_needed=c;h(a)})})})}},g=function(a,d){var c=b.detachContext(a);if(b.isEmpty(a.database))return b.safeApply(d,[a]);c.on_success=function(a){a.on_success=null;a.version=a.db.version;a.db.close();b.safeApply(d,[a])};c.on_upgrade_needed=function(a){a.upgraded=!0;a.version=a.new_version;
a.on_upgrade_needed=null;a.transaction.oncomplete=function(){a.db.close();b.safeApply(d,[a])}};b.database.get(c)},n=function(a,c){var f=b.detachContext(a);if(b.isEmpty(a.store)||b.contains(["add.store"],d))return b.safeApply(c,[a]);f.on_success=function(a){a.on_success=null;a.db=a.request.result;a.db.objectStoreNames.contains(a.store)?(b.isnt(a.transaction,null)&&(a.objectstore=a.transaction.objectStore([a.store],e)),a.db.close(),b.safeApply(c,[a])):(a.version=a.db.version+1,a.on_success=null,a.on_upgrade_needed=
function(a){a.on_upgrade_needed=null;a.transaction.addEventListener("complete",function(){a.db.close();b.safeApply(c,[a])});a.objectstore=a.db.createObjectStore(a.store,{keyPath:b.isString(a.store_key_path)?a.store_key_path:null,autoIncrement:b.isBoolean(a.auto_increment)?a.auto_increment:!1})},b.database.get(a))};f.version=null;b.database.get(f)},l=function(a,c){var e=b.detachContext(a);if(b.isEmpty(a.store)||b.isEmpty(a.index)||b.contains("add.store get.store remove.store get.stores remove.stores remove.index add.index".split(" "),
d))return b.safeApply(c,[a]);e.on_success=function(d){d.on_success=null;d.db=d.request.result;d.objectstore=d.db.transaction([d.store],b.transaction.read).objectStore(d.store);d.transaction=d.objectstore.transaction;d.objectstore.indexNames.contains(a.index)?(d.db.close(),b.safeApply(c,[d])):(d.version=d.db.version+1,d.on_success=null,d.on_upgrade_needed=function(a){a.objectstore=a.transaction.objectStore([a.store]);a.on_upgrade_needed=null;a.transaction.addEventListener("complete",function(){a.on_success=
null;b.safeApply(c,[a]);a.db.close()});a.on_success=null;a.idx=a.objectstore.createIndex(a.index,a.index_key_path,{unique:a.index_unique||!1,multiEntry:a.index_multi_entry||!1})},d.db.close(),b.database.get(d))};b.database.get(e)},h=function(c){var g=c.on_success,h=c.on_complete,k=b.detachContext(c),q=function(c){b.exists(c.store)&&b.isnt(e,b.transaction.versionChange)?(b.is(c.transaction,null)&&(c.transaction=c.db.transaction([c.store],e)),c.objectstore=c.transaction.objectStore(c.store),c.transaction.addEventListener("complete",
function(){c.db.close();f()})):b.exists(c.store)&&(c.db=c.request.result,c.transaction=c.request.transaction,b.is(c.transaction,null)&&(c.transaction=c.db.transaction([c.store],e)),b.contains(["add.store","remove.store"],d)||(c.objectstore=c.transaction.objectStore(c.store)),c.transaction.addEventListener("complete",function(){c.db.close();f()}));c.on_success=function(a){a=b.results(a);a.on_success=g;b.success(a)};c.on_complete=function(a){a=b.results(a);a.on_complete=h;b.safeApply(a.on_complete,
[a])};b.safeApply(a,[c])};k.version=c.version;if(b.contains(["get.databases","remove.database","get.database"],d))return b.safeApply(a,[c]);b.isnt(b.transaction.versionChange,e)?(k.on_success=q,k.on_upgrade_needed=null):(k.version=c.db.version+1,k.on_upgrade_needed=q,k.on_success=null);k.on_complete=null;b.database.get(k)};c=b.args(c);c.type=e;b.transaction.queues.push(c);f()};b.wrap=function(a,c){return function(d){d=d||{};var e={};b.safeEach(b.standardCallbackNames,function(a){e[a.replace(/^on_/,
"")]=d[a]});return function(a,d,e,l){var h=b.deferred(),m=b.contains(["get.entries","update.entries","remove.entries"],c),p={success:"s",error:"e",abort:"a",complete:"c",upgrade_needed:"u",blocked:"b",closed:"l"};b.safeIterate(d,function(c){a["on_"+c]=function(a,c){return function(d){b.isObject(d)&&b.safeIterate(c,function(a,c){var e="on_"+a;b.isFunction(c)?d[e]=c:delete d[e]});d=b.args(d);var e;e=b.is(a,"s")&&b.is(m,!0)?h.notify:b.is(a,"e")||b.is(a,"a")||b.is(a,"b")?h.reject:h.resolve;b.safeApply(e,
[d],h)}}(p[c],d)});try{b.stage(e,a,l)}catch(s){a.error=s,b.error(a)}return h.promise}(d,e,a,c)}};return function(a){var c={},d=[],e;b.safeIterate(a,function(a,g){d=a.split(".");e=d[0];c[e]=c[e]||{};c[e][d[1]]=b.wrap(g,a)});return c}({"add.entry":b.entry.add,"get.database":b.database.get,"get.databases":b.databases.get,"get.store":b.store.get,"get.stores":b.stores.get,"get.index":b.index.get,"get.indexes":b.indexes.get,"get.entry":b.entry.get,"get.entries":b.entries.get,"update.entries":b.entries.update,
"put.entry":b.entry.put,"clear.store":b.store.clear,"remove.database":b.database.remove,"remove.store":b.store.remove,"remove.index":b.index.remove,"remove.entry":b.entry.remove,"remove.entries":b.entries.remove})}(window||{});