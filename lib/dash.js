var dash=function(){var b={dbs:{},database:{},databases:{},store:{},stores:{},index:{},indexes:{},range:{},object:{},objects:{},transaction:{},kr:window.IDBKeyRange,clone:function(a){var c={};if(b.isNumber(a))return parseInt(a,10);if(b.isArray(a))return a.slice(0);b.safeIterate(a,function(a,e){!b.isObject(e)||b.isFunction(e)||b.isArray(e)?c[a]=e:c[a]=b.clone(e)});return c},isEmpty:function(a){return b.isnt(a,void 0)&&b.isnt(a,null)&&b.isnt(a,"")&&(!b.isArray(a)||0<a.length)?!1:!0},exists:function(a){return b.isEmpty(a)?
!1:!0},contains:function(a,c,d){var e=!1;b.exists(a)&&b.safeIterate(a,function(a,g){if(b.is(d,!0)&&b.is(a,c)||b.is(g,c))e=!0});return e},hasPath:function(a,c){var d=c.split("."),e=d.shift();if(b.isEmpty(a))return!1;for(;e;){if(b.isEmpty(a[e]))return!1;a=a[e];e=d.shift()}return!0},is:function(a,b){return b===a},isnt:function(a,b){return b!==a},isObject:function(a){return b.isnt(a,null)&&b.isType("object",a)&&b.is("[object Object]",a.toString())},isString:function(a){return b.isType("string",a)},isFunction:function(a){return b.isType("function",
a)},attribs:"data on_success on_blocked on_upgrade_needed on_abort on_error duplicates key store_key_path store index index_key_path database db type entries entry databases objectstore idx stores indexes store_creating db_creating idx_creating blocked_count callback event version on_complete auto_increment unique multi_entry index_key_path index_unique index_multi_entry new_version version old_version".split(" "),results:function(a){var c={};b.safeEach(b.attribs,function(d,e){b.exists(a[e])&&(b.is(e,
"db")?c[e]={name:a[e].name,version:a[e].version,objectStoreNames:a[e].objectStoreNames}:b.is(e,"objectstore")?c[e]={name:a[e].name,indexNames:a[e].indexNames,autoIncrement:a[e].autoIncrement,keyPath:a[e].keyPath}:b.is(e,"idx")?c[e]={name:a[e].name,multiEntry:a[e].multiEntry,unique:a[e].unique,keyPath:a[e].keyPath}:c[e]=a[e])});return c},args:function(a){var c={};b.safeEach(b.attribs,function(d,e){b.exists(a[e])&&(c[e]=a[e])});return c},isArray:function(a){var b=!1;if(a instanceof Array||a instanceof
DOMStringList)b=!0;return b},isNumber:function(a){return b.isType("number",a)||b.is(isNaN(parseInt(a,10),!1))?!0:!1},isBoolean:function(a){return b.isType("boolean",a)||b.is(a,"true")||b.is(a,"false")?!0:!1},isType:function(a,c){return b.is(a,typeof c)},extend:function(a,c,d){a=a||{};b.safeIterate(b.clone(c),function(c,f){b.is(!0,d)&&b.isObject(f)?a[c]=b.extend({},f,d):a[c]=f});return a},safeIterate:function(a,b){for(var d in a)a.hasOwnProperty(d)&&b(d,a[d])},safeEach:function(a,c,d){var e=a.length,
f=1;!0===d&&(f=-f);for(d=0;d<e;d+=f)b.safeApply(c,[d,a[d]])},safeApply:function(a,c,d,e){if(b.isFunction(a))return a.apply(d||b,c||[]);if(b.isFunction(e))return b.safeApply(e,[])},standardCallbackNames:"on_success on_error on_abort on_blocked on_upgrade_needed on_close on_complete".split(" ")};b.safeEach(b.standardCallbackNames,function(a,c){b[c.replace(/^on_/g,"")]=function(a){b.safeApply(a[c],[a]);return a}});b.standardRequest=function(a){var c=a.request,d={};a=b.standardCallbacks(a);b.exists(c)&&
b.is(c.readyState,"done")&&b.success(a);b.safeEach(b.standardCallbackNames,function(b,c){d[c.replace(/_/g,"")]=a[c]});a.request=b.extend(c,d);return a};b.standardCursor=function(a,c){var d=function(b){a.event=b;return a},e;a.direction=a.direction||b.objects.next();a.range=a.range||b.range.get(a);a.entries=[];a.data=b.isFunction(a.data)?a.data():b.clone(a.data);try{b.isEmpty(a.transaction)&&(a.db=a.event.target.result,a.transaction=a.db.transaction([a.store],a.type)),b.isEmpty(a.objectstore)&&(a.objectstore=
a.transaction.objectStore(a.store)),b.isEmpty(a.idx)&&!b.isEmpty(a.index)&&(a.idx=a.objectstore.index(a.index)),e=b.isEmpty(a.index)?a.objectstore.openCursor(a.range,a.direction):a.idx.openCursor(a.range,a.direction),e.transaction.addEventListener("complete",function(c){a.cursor=e.result;a=d(c);a.db.close();b.complete(a)}),e.transaction.addEventListener("error",function(c){a.error=c;a=d(c);b.error(a)}),e.addEventListener("success",function(g){a.cursor=e.result;a.entries=a.entries||[];a=d(g);b.safeApply(c,
[a])})}catch(f){a.error=f,b.error(a)}};b.standardCallbacks=function(a){var c={},d=function(d){a.event=d;a.transaction=a.request?a.request.transaction:d.target.transaction;b.exists(a.transaction)&&b.exists(a.transaction.db)&&(a.db=a.transaction.db);b.exists(d.newVersion)?(a.new_version=d.newVersion,a.old_version=d.oldVersion,b.isnt(a.old_version,a.new_version)?a.upgrade=!0:a.upgrade=!1):a.upgrade=!1;return a};b.safeEach(b.standardCallbackNames,function(e,f){c[f]=function(){return function(c){b.safeApply(a[f],
[d(c)])}}()});return c};b.transaction.read="readonly";b.transaction.readWrite="readwrite";b.transaction.versionChange="versionchange";b.database.close=function(a,c){a.db.close();b.isnt(c,!0)&&b.success(a)};b.database["delete"]=function(a,c){indexedDB.deleteDatabase(a.database);b.isnt(c,!0)&&b.success(close_ctx)};b.database.open=function(a){var c=a.on_upgrade_needed,d=a.on_success,e=a.on_blocked,f=!1;a.request=b.isNumber(a.version)?indexedDB.open(a.database,a.version):indexedDB.open(a.database);a.db&&
a.db.close();b.standardRequest(b.extend(a,{on_success:function(a){f||(a.upgrade=!1,a.opened=!0,a.on_success=d,a.db=a.event.target.result,b.success(a))},on_upgrade_needed:function(a){f=!0;a.upgrade=!0;a.opened=!0;a.on_upgrade_needed=c;b.upgrade_needed(a)},on_blocked:function(a){b.safeApply(e,[a])}}))};b.databases.get=function(a){var c=a.on_success;if(!b.isFunction(indexedDB.webkitGetDatabaseNames))return b.error(a);a.request=indexedDB.webkitGetDatabaseNames();a.request.addEventListener("success",function(d){a.databases=
d.target.result;a.on_success=c;b.success(a)})};b.store.clear=function(a){a.objectstore.clear();b.success(a)};b.store["delete"]=function(a){a.db.deleteObjectStore(a.store);b.success(a)};b.store.create=function(a){a.objectstore=a.db.createObjectStore(a.store,{keyPath:b.isString(a.store_key_path)?a.store_key_path:null,autoIncrement:b.isBoolean(a.auto_increment)?a.auto_increment:!1});b.success(a)};b.store.get=function(a){b.success(a)};b.stores.get=function(a){a.stores=a.db.objectStoreNames;b.success(a)};
b.index.create=function(a){a.idx=a.objectstore.createIndex(a.index,a.index_key_path,{unique:a.index_unique||!1,multiEntry:a.index_multi_entry||!1});b.success(a)};b.index.get=function(a){a.idx=a.objectstore.index(a.index);b.success(a)};b.index["delete"]=function(a){a.objectstore.deleteIndex(a.index);b.success(a)};b.indexes.get=function(a){a.indexes=a.objectstore.indexNames;b.success(a)};b.object.add=function(a){var c;a.data=b.isFunction(a.data)?a.data():b.clone(a.data);c=a.objectstore.add(a.data);
a.transaction.addEventListener("error",function(d){a.error=d.target.error.message;b.error(a)});c.addEventListener("success",function(d){a.key=c.result;b.success(a)})};b.object["delete"]=function(a){var c,d=b.exists(a.range)||b.exists(a.upper)||b.exists(a.lower)||b.exists(a.only);a.data=b.isFunction(a.data)?a.data():b.clone(a.data);c=a.objectstore["delete"](d?a.range||b.range.get(a):a.key);a.transaction.addEventListener("complete",function(){a.entry=c.result;b.success(a)});a.transaction.addEventListener("error",
function(d){a.error=d.target.error.message;b.error(a)})};b.object.get=function(a){var c;a.data=b.isFunction(a.data)?a.data():b.clone(a.data);b.exists(a.index)?(a.idx=a.objectstore.index(a.index),c=b.is(a.value,!1)?a.idx.getKey(a.key):a.idx.get(a.key)):c=a.objectstore.get(a.key);a.transaction.addEventListener("error",function(d){a.error=d.target.error.message;b.error(a)});c.addEventListener("success",function(d){a.entry=c.result;b.success(a)})};b.object.put=function(a){var c;a.data=b.isFunction(a.data)?
a.data():b.clone(a.data);c=b.exists(a.key)?a.objectstore.put(a.data,a.key):a.objectstore.put(a.data);a.transaction.addEventListener("complete",function(){a.key=c.result;b.success(a)});a.transaction.addEventListener("error",function(d){a.error=d.target.error.message;b.error(a)})};b.objects["delete"]=function(a){a.type=b.transaction.readWrite;var c=a.on_success;b.standardCursor(a,function(a){a.entry=a.request;if(b.exists(a.cursor)&&(a.on_success=c,a.entry=a.cursor.value,a.entries=a.entries||[],a.entries.push(a.entry),
a.cursor["delete"](),b.success(a),b.exists(a.cursor["continue"])))a.cursor["continue"]()})};b.objects.get=function(a){a.type=b.transaction.read;var c=a.on_success;a.on_success=null;b.standardCursor(a,function(a){if(b.isnt(a.cursor,null)&&(a.on_success=c,a.entry=a.cursor.value,a.entries=a.entries||[],a.entries.push(a.entry),b.success(a),b.exists(a.cursor["continue"])))a.cursor["continue"]()})};b.objects.update=function(a){a.type=b.transaction.readWrite;var c=a.on_success;b.standardCursor(a,function(a){if(b.exists(a.cursor)&&
(a.on_success=c,a.entry=a.cursor.value,a.entries=a.entries||[],a.entries.push(a.entry),a.cursor.update(a.data),b.success(a),b.exists(a.cursor["continue"])))a.cursor["continue"]()})};b.range.get=function(a){var c=null,d=a.left_bound,e=a.right_bound,f=a.includes_left_bound,g=a.includes_right_bound;b.exists(d)&&b.exists(e)&&b.exists(f)&&b.exists(g)?c=b.kr.bound(d,e,f,g):b.exists(d)&&b.exists(f)?c=b.kr.lowerBound(d,f):b.exists(e)&&b.exists(g)?c=b.kr.upperBound(e,g):b.exists(a.value)&&(c=b.kr.only(a.value));
a.result=c;b.success(a);return c};b.objects.next=function(a){return b.exists(a)&&b.is(!1,a.duplicates)?"nextunique":"next"};b.objects.previous=function(a){return b.exists(a)&&b.is(!1,a.duplicates)?"prevunique":"prev"};b.deferred=function(){var a=!1,c=null,d=[],e=[],f=[],g=[],k=[];return{promise:{then:function(h,l,n){var m=b.deferred();e.push(m);b.is(a,!0)?b.safeApply(c?h:l,d):b.safeEach([[g,h],[k,l],[f,n]],function(a,c){var d=c[1];b.isFunction(d)&&c[0].push(d)});return m.promise},otherwise:function(a,
b){return this.then(null,a,b)},updates:function(a){return this.then(null,null,a)}},resolve:function(){var f=arguments;b.is(a,!1)&&(c=!0,d=f,b.safeEach(g,function(a,c){b.safeApply(c,f)}),b.safeEach(e,function(a,c){b.safeApply(c.resolve,f)}))},notify:function(){var a=arguments;b.safeEach(f,function(c,d){b.safeApply(d,a)});b.safeEach(e,function(c,d){b.safeApply(d.notify,a)})},reject:function(){var e=arguments;b.is(a,!1)&&(c=!1,a=!0,d=e,b.safeEach(k,function(a,c){b.safeApply(c,e)}))}}};b.transaction.queues=
[];b.transaction.type=function(a){return b.contains(["add.index","remove.index","add.store","remove.store"],a)?b.transaction.versionChange:b.contains(["get.entry","get.entries"],a)?b.transaction.read:b.transaction.readWrite};b.detachContext=function(a){return{database:a.database,store:a.store,version:null,store_key_path:a.store_key_path,unique:a.unique,multi_entry:a.multi_entry,data:a.data,auto_increment:a.auto_increment,on_complete:a.on_complete,key:a.key,index:a.index,index_key_path:a.index_key_path,
index_multi_entry:a.index_multi_entry,index_unique:a.index_unique}};b.stage=function(a,c,d){var e=b.transaction.type(d),f=function(a,c){var d=b.detachContext(a);if(b.isEmpty(a.database))return b.safeApply(c,[a]);d.on_success=function(a){a.on_success=null;a.version=a.db.version;a.db.close();b.safeApply(c,[a])};d.on_upgrade_needed=function(a){a.upgraded=!0;a.version=a.new_version;a.on_upgrade_needed=null;a.transaction.oncomplete=function(){a.db.close();b.safeApply(c,[a])}};b.database.open(d)},g=function(a,
c){var f=b.detachContext(a);if(b.isEmpty(a.store)||b.contains(["add.store","remove.store","get.store","get.stores"],d))return b.safeApply(c,[a]);f.on_success=function(a){a.on_success=null;a.db=a.request.result;a.db.objectStoreNames.contains(a.store)?(b.isnt(a.transaction,null)&&(a.objectstore=a.transaction.objectStore([a.store],e)),a.db.close(),b.safeApply(c,[a])):(a.version=a.db.version+1,a.on_success=null,a.on_upgrade_needed=function(a){a.on_upgrade_needed=null;a.transaction.addEventListener("complete",
function(){a.db.close();b.safeApply(c,[a])});b.store.create(a)},b.database.open(a))};f.version=null;b.database.open(f)},k=function(a,c){var e=b.detachContext(a);if(b.isEmpty(a.store)||b.isEmpty(a.index)||b.contains("add.store get.store remove.store get.stores remove.stores remove.index add.index".split(" "),d))return b.safeApply(c,[a]);e.on_success=function(d){d.on_success=null;d.db=d.request.result;d.objectstore=d.db.transaction([d.store],b.transaction.read).objectStore(d.store);d.transaction=d.objectstore.transaction;
if(d.objectstore.indexNames.contains(a.index))d.db.close(),b.safeApply(c,[d]);else{d.version=d.db.version+1;var e=function(a){a.transaction.addEventListener("complete",function(){a.on_success=null;b.safeApply(c,[a]);a.db.close()});a.on_success=null;b.index.create(a)};d.on_success=null;d.on_upgrade_needed=function(a){a.objectstore=a.transaction.objectStore([a.store]);a.on_upgrade_needed=null;e(a)};d.db.close();b.database.open(d)}};b.database.open(e)},h=function(a){if(b.contains(["get.database","remove.database"],
d))return l(a);var c=a.on_upgrade_needed,e=a.on_success;a.on_success=null;a.on_upgrade_needed=null;f(a,function(a){g(a,function(a){k(a,function(a){a.on_success=e;a.on_upgrade_needed=c;l(a)})})})},l=function(c){var f=c.on_success,g=c.on_complete,h=b.detachContext(c),k=function(c){b.exists(c.store)&&b.isnt(e,b.transaction.versionChange)?(b.is(c.transaction,null)&&(c.transaction=c.db.transaction([c.store],e)),c.objectstore=c.transaction.objectStore(c.store),c.transaction.addEventListener("complete",
function(){c.db.close()})):b.exists(c.store)&&(c.db=c.request.result,c.transaction=c.request.transaction,b.is(c.transaction,null)&&(c.transaction=c.db.transaction([c.store],e)),b.contains(["add.store","remove.store"],d)||(c.objectstore=c.transaction.objectStore(c.store)),c.transaction.addEventListener("complete",function(){c.db.close()}));c.on_success=function(a){a=b.results(a);a.on_success=f;b.success(a)};c.on_complete=function(a){a=b.results(a);a.on_complete=g;b.safeApply(a.on_complete,[a])};b.safeApply(a,
[c])};h.version=c.version;if(b.contains(["get.databases","remove.database","get.database"],d))return b.safeApply(a,[c]);b.isnt(b.transaction.versionChange,e)?h.on_success=k:(h.version=c.db.version+1,h.on_upgrade_needed=k);b.database.open(h)};c=b.args(c);c.type=e;b.transaction.queues.push(c);(function(){var a=b.transaction.queues.shift();b.isnt(a,null)&&h(a)})()};b.wrap=function(a,c){return function(d){d=d||{};return function(a,d,g,k){var h=b.deferred(),l=b.contains(["get.entries","update.entries",
"remove.entries"],c),n={success:"s",error:"e",abort:"a",complete:"c",upgrade_needed:"u",blocked:"b",closed:"l"};b.safeIterate(d,function(c,g){a["on_"+c]=function(a,c){return function(d){b.isObject(d)&&b.safeIterate(c,function(a,c){var e="on_"+a;b.isFunction(c)?d[e]=c:delete d[e]});d=b.args(d);var e;e=b.is(a,"s")?l?h.notify:h.resolve:b.is(a,"e")||b.is(a,"a")||b.is(a,"b")?h.reject:h.resolve;b.safeApply(e,[d],h)}}(n[c],d)});try{b.stage(g,a,k)}catch(m){a.error=m}return h.promise}(d,{success:d.on_success,
error:d.on_error,abort:d.on_abort,complete:d.on_complete,upgrade_needed:d.on_upgrade_needed,blocked:d.on_blocked,close:d.on_close},a,c)}};return function(a){var c={},d=[],e,f=/^_/;b.safeIterate(a,function(a,k){d=a.split(".");b.isnt(d[0].match(f),null)?(e=d[0].replace(f,""),c[e]=c[e]||{},c[e][d[1]]=k):(e=d[0],c[e]=c[e]||{},c[e][d[1]]=b.wrap(k,a))});return c}({"add.store":b.store.create,"add.entry":b.object.add,"add.index":b.index.create,"get.database":b.database.open,"get.databases":b.databases.get,
"get.store":b.store.get,"get.stores":b.stores.get,"get.index":b.index.get,"get.indexes":b.indexes.get,"get.entry":b.object.get,"get.entries":b.objects.get,"update.entries":b.objects.update,"put.entry":b.object.put,"clear.store":b.store.clear,"remove.database":b.database["delete"],"remove.store":b.store["delete"],"remove.index":b.index["delete"],"remove.entry":b.object["delete"],"remove.entries":b.objects["delete"],"_tools.extend":b.extend,"_tools.defer":b.deferred})}();